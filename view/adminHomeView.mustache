<main>
<div class="container2">
<nav class="nav" id="nav">
    <ul>
        <li>
            <a href="/TP_Final-PW2_UNLaM/user/logout">
                <div class="icono" id="2">
                    <i class="fa-solid fa-arrow-right-from-bracket"></i>
                </div>
                Cerrar Sesión
            </a>
        </li>
    </ul>
</nav>

    {{#usuario}}
         <div class="row mb-3 justify-content-center">
            <p class="titulo"> Hola {{nombre}} </p>

            <div class="box-datos col-sm-4 text-center p-4">
                {{jugadoresActivos}}
                <p>JUGADORES ACTIVOS</p>
            </div>
            <div class="box-datos col-sm-4 text-center p-4">
                {{jugadoresNuevos}}
                <p>JUGADORES NUEVOS</p>
            </div>
            <div class="box-datos col-sm-4 text-center p-4">
                {{totalPartidas}}
                <p>PARTIDAS JUGADAS</p>
            </div>
            <div class="box-datos col-sm-4 text-center p-4">
                {{totalPreguntas}}
                <p>PREGUNTAS ACTIVAS</p>
            </div>
            <div class="box-datos col-sm-4 text-center p-4">
                {{totalPreguntasCreadas}}
                <p>PREGUNTAS SUGERIDAS</p>
            </div>
        </div>
    {{/usuario}}</div>
    <br>

    <div id="botones-graficos" class="row">
        <div class="col-md-6 mb-3">
            <div id="filtrarFecha" class="d-flex align-items-center select-filtro">
                <select id="filtrar" name="filtrar" class="">
                    <option value="noFilter">Sin filtro</option>
                    <option value="day">Día</option>
                    <option value="week">Semana</option>
                    <option value="month">Mes</option>
                    <option value="year">Año</option>
                </select>
                <button id="aplicarFiltro" class="btn button">Filtrar</button>
            </div>
        </div>

        <div class="col-md-6 mb-3 text-end">
            <div class="imprimir">
                <button id="imprimir-pdf" class="btn button">Imprimir</button>
            </div>
        </div>
    </div>
    <br>

    <div id="graficos" class="row mb-3">
        <div class="contenedor-grafico">
            <img src="/TP_Final-PW2_UNLaM/admin/players">
        </div>

        <div class="contenedor-grafico">
            <img src="/TP_Final-PW2_UNLaM/admin/games">
        </div>

        <div class="contenedor-grafico">
            <img src="/TP_Final-PW2_UNLaM/admin/questions">
        </div>

        <div class="contenedor-grafico">
            <img src="/TP_Final-PW2_UNLaM/admin/percentageOfCorrectAnswers">
        </div>

        <div class="contenedor-grafico">
            <img src="/TP_Final-PW2_UNLaM/admin/usersByCountry">
        </div>

        <div class="contenedor-grafico">
            <img src="/TP_Final-PW2_UNLaM/admin/usersBySex">
        </div>

        <div class="contenedor-grafico">
            <img src="/TP_Final-PW2_UNLaM/admin/usersByAgeGroup">
        </div>
    </div>
</main>

<script>
// Espera a que se cargue completamente el contenido HTML y los recursos asociados
document.addEventListener('DOMContentLoaded', function() {
    
    // Agrega un evento de clic al botón con id 'imprimir-pdf'
    document.getElementById('imprimir-pdf').addEventListener('click', function() {
        
        // Crea dinámicamente un formulario
        var form = document.createElement('form');
        
        // Establece la URL a la que se enviará el formulario
        form.action = '/TP_Final-PW2_UNLaM/Admin/generarPdf';
        
        // Establece el método HTTP para enviar el formulario
        form.method = 'POST';
        
        // Establece un estilo para el formulario - en este caso, hay un error: '_blank' no es válido para 'display'
        // Probablemente debería ser form.style.display = 'none'; para ocultar el formulario creado temporalmente
        form.style.display = '_blank';
        
        // Crea un campo de entrada oculto dentro del formulario
        var inputHtml = document.createElement('input');
        
        // Establece el tipo de campo como 'hidden'
        inputHtml.type = 'hidden';
        
        // Nombre del campo que se enviará al servidor
        inputHtml.name = 'htmlGrafico';
        
        // Valor que se enviará al servidor - aquí falta la definición de 'graficos'
        inputHtml.value = graficos;
        
        // Adjunta el campo de entrada al formulario
        form.appendChild(inputHtml);
        
        // Adjunta el formulario recién creado al final del body del documento
        document.body.appendChild(form);
        
        // Envía automáticamente el formulario al servidor
        form.submit();
    });
});
</script>


<script>
document.addEventListener('DOMContentLoaded', function() {
    // Escucha el evento cuando el botón de aplicar filtro es clickeado
    document.getElementById('aplicarFiltro').addEventListener('click', function() {
        // Obtiene el valor seleccionado en el select de filtro
        var filtro = document.getElementById('filtrar').value;
        
        // Busca todas las imágenes que tengan src que contengan la cadena "/TP_Final-PW2_UNLaM/admin/"
        var urls = document.querySelectorAll('img[src*="/TP_Final-PW2_UNLaM/admin/"]');
        
        // Itera sobre todas las imágenes encontradas
        urls.forEach(function(url) {
            // Llama a la función updateUrl para actualizar el src de cada imagen con el filtro seleccionado
            url.src = updateUrl(url.src, filtro);
        });
    });

    // Función para actualizar la URL de la imagen con el filtro seleccionado
    function updateUrl(url, filter) {
        // Divide la URL en baseUrl (parte antes del '?') y params (parte después del '?')
        var baseUrl = url.split('?')[0]; // URL base sin parámetros de consulta
        var params = new URLSearchParams(url.split('?')[1]); // Obtiene los parámetros de consulta como un objeto URLSearchParams
        
        // Si no se aplica ningún filtro, devuelve la URL base sin cambios
        if (filter === "noFilter") {
            return baseUrl;
        } else {
            // Establece el parámetro 'filtro' con el valor seleccionado
            params.set('filtro', filter);
            return baseUrl + '?' + params.toString();
        }
    }
});
</script>